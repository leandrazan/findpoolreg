## ---- include = FALSE-----------------------------------------------------------------------------------------------------------------------
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

## ----setup, warning=F, message=F------------------------------------------------------------------------------------------------------------
library(findpoolreg)
library(dplyr)

## -------------------------------------------------------------------------------------------------------------------------------------------
data("example_data")
data("example_grid")
data("GMST")

pool_reg <- as.character(c(4,5,7,8))
pool_dat <- example_data[ , pool_reg]
pool_grid <- example_grid %>% dplyr::filter(Region %in% pool_reg)
head(pool_dat)
head(pool_grid)

cvrt <- GMST$smoothedGMST[68:142]


## -------------------------------------------------------------------------------------------------------------------------------------------
gev_pool <- fit_scalegev(pool_dat, temp.cov = cvrt, hessian = FALSE)
gev_pool

## -------------------------------------------------------------------------------------------------------------------------------------------
  ref21 <- (GMST %>% dplyr::filter( Year == 2021))$smoothedGMST
  tile_rl <- compute_rl(theta = gev_pool$mle, type = "scale", ref_gmst = ref21, Tyrl = 100)
  tile_rl 

## -------------------------------------------------------------------------------------------------------------------------------------------
reg_est <- get_regionwise_estimates(data = pool_dat, coords = as.matrix(pool_grid[ , 6:7]), 
                                    temp.cov = cvrt, ref_gmst = ref21, B = 10000, 
                                    r = tile_rl$rl, T.year = 100)
reg_est

## -------------------------------------------------------------------------------------------------------------------------------------------
 quantile(reg_est$ecdf_max, p = 1-1/50)

## -------------------------------------------------------------------------------------------------------------------------------------------
1/(1- reg_est$ecdf_max(58))

